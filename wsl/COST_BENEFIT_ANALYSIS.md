# 💰 WSL Proof Server 도입 비용-효과 분석

## 📊 속도 비교

### 현재 방식 (브라우저 Web Worker)
- **소요 시간**: 약 **15-20초**
- **타임아웃**: 120초
- **장점**: 
  - 추가 인프라 불필요
  - 사용자 기기에서 직접 실행
  - 네트워크 의존성 없음
- **단점**:
  - 느린 기기에서는 더 오래 걸림
  - 브라우저 메모리 사용량 증가

### WSL Proof Server 방식
- **예상 소요 시간**: 약 **3-6초**
- **속도 향상**: **약 3-5배** (15-20초 → 3-6초)
- **장점**:
  - 빠른 증명 생성
  - 브라우저 부하 감소
  - 일관된 성능
- **단점**:
  - 추가 인프라 필요 (WSL 설정, 서버 실행)
  - 네트워크 의존성 (localhost:8787)
  - 프론트엔드 코드 수정 필요

---

## 🔧 수정 범위 분석

### 필요한 수정 사항

#### 1. 프론트엔드 코드 수정
**파일**: `src/app/vote/[pollId]/page.tsx`

**수정 내용**:
```typescript
// 현재: generateProofInWorker() 함수만 사용
// 수정: WSL 서버 호출 로직 추가 + 폴백 로직

// 1. 환경 변수 추가
const PROOF_SERVER_URL = process.env.NEXT_PUBLIC_PROOF_SERVER_URL || 'http://localhost:8787'

// 2. WSL 서버 호출 함수 추가
async function generateProofInServer(payload) {
  try {
    const response = await fetch(`${PROOF_SERVER_URL}/prove`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    })
    const data = await response.json()
    if (data.ok) return data
    throw new Error(data.error)
  } catch (error) {
    // 서버 실패 시 브라우저로 폴백
    console.warn('[Vote] Proof server failed, falling back to browser')
    return generateProofInWorker(payload)
  }
}

// 3. handleVoteClick() 함수 수정
// - WSL 서버 사용 여부 확인
// - 서버 우선 시도, 실패 시 브라우저로 폴백
```

**예상 수정 라인 수**: 약 **50-80줄**

#### 2. 환경 변수 추가
**파일**: `.env.local`, `vercel.json`

```env
NEXT_PUBLIC_PROOF_SERVER_URL=http://localhost:8787
```

#### 3. WSL 설정 및 서버 실행
- WSL 설치 및 설정
- npm install (WSL 환경)
- 서버 실행 스크립트

---

## 📈 속도 향상 효과

### 시나리오별 비교

| 시나리오 | 브라우저 Web Worker | WSL 서버 | 향상율 |
|---------|-------------------|---------|--------|
| **일반 노트북** | 15-20초 | 3-6초 | **3-5배** |
| **고성능 PC** | 10-15초 | 3-5초 | **2-3배** |
| **저사양 기기** | 20-30초 | 4-7초 | **4-5배** |

### 실제 체감 효과
- **15-20초 → 3-6초**: 약 **10-15초 단축**
- 시연 시: 대기 시간이 크게 줄어듦
- 사용자 경험: "빠르다"는 인상

---

## ⚖️ 비용-효과 분석

### ✅ 도입 시 이점
1. **속도 향상**: 3-5배 빠름
2. **시연 효과**: 더 부드러운 데모
3. **저사양 기기 지원**: 느린 기기에서도 빠른 증명 생성

### ❌ 도입 시 비용
1. **코드 수정**: 약 50-80줄 추가
2. **인프라 관리**: WSL 설정, 서버 실행, 유지보수
3. **복잡도 증가**: 폴백 로직, 에러 처리 추가
4. **테스트 필요**: 서버/브라우저 양쪽 테스트

---

## 🎯 결론 및 권장사항

### 현재 방식을 유지하는 것이 좋은 경우
✅ **다음 조건 중 하나라도 해당되면 유지 권장**:
- 코드 수정이 부담스러움
- 시연 시간이 충분함 (15-20초도 괜찮음)
- 추가 인프라 관리가 어려움
- 현재 시스템이 잘 작동함

### WSL 서버를 도입하는 것이 좋은 경우
✅ **다음 조건이 모두 해당되면 도입 고려**:
- 시연 시 속도가 매우 중요함
- 코드 수정 여유가 있음
- WSL 환경 설정이 가능함
- 저사양 기기 지원이 필요함

---

## 💡 최종 권장사항

### **현재 방식을 유지하는 것을 권장합니다**

**이유**:
1. **수정 범위**: 50-80줄 코드 수정 + 인프라 설정 필요
2. **속도 향상**: 3-5배 빠르지만, 15-20초도 충분히 빠름
3. **복잡도**: 폴백 로직, 에러 처리 등 복잡도 증가
4. **유지보수**: 추가 인프라 관리 필요

**대안**:
- 현재 브라우저 Web Worker 방식 유지
- 시연 시: "약 15초 정도 소요됩니다"라고 안내
- 대부분의 사용자에게는 충분히 빠름

---

## 📝 요약

| 항목 | 브라우저 Web Worker | WSL 서버 |
|------|-------------------|---------|
| **속도** | 15-20초 | 3-6초 (3-5배 빠름) |
| **코드 수정** | 없음 | 50-80줄 필요 |
| **인프라** | 불필요 | WSL 설정 필요 |
| **복잡도** | 낮음 | 중간 |
| **유지보수** | 쉬움 | 추가 관리 필요 |

**결론**: 속도 향상은 있지만, 수정 범위와 복잡도 증가를 고려하면 **현재 방식을 유지하는 것이 더 실용적**입니다.

