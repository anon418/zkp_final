# ⚠️ 시스템 한계 및 개선 방향

> **현재 시스템의 한계점과 향후 개선 계획**

---

## 🔓 Open Poll 방식의 한계

### 현재 구현

**현재 시스템은 Open Poll 방식입니다:**

- **Merkle Tree 미사용**: `merkleRoot = 0x00...00` (모든 유권자 허용)
- **화이트리스트 없음**: 누구나 투표 가능
- **신원 검증 없음**: MetaMask 지갑 주소만으로 투표

### 한계점

#### 1. 중복 투표 가능

**문제**:

- 같은 사람이 여러 MetaMask 지갑을 만들어서 여러 번 투표 가능
- 예: 동일한 Google 계정으로 여러 지갑 생성 → 여러 번 투표

**왜 차단되지 않는가?**:

- `nullifier = Poseidon(nullifierSecret, pollId)`
- `nullifierSecret`은 각 지갑마다 다르므로, 다른 지갑 = 다른 nullifier
- 따라서 같은 사람이 여러 지갑을 만들면 여러 번 투표 가능

**현재 차단되는 것**:

- ✅ 같은 지갑 주소로는 중복 투표 불가 (완벽하게 차단)
- ❌ 다른 지갑 주소로는 중복 투표 가능

#### 2. 실제 신원 검증 없음

**문제**:

- MetaMask 지갑 주소만으로 투표
- 실제 신원(학번, 이메일 등) 검증 없음
- 누가 투표했는지 알 수 없음 (익명성은 보장되지만, 신원 검증 불가)

#### 3. 화이트리스트 기능 없음

**문제**:

- 특정 유권자만 투표할 수 있도록 제한 불가
- 예: "학과 재학생만 투표 가능" 같은 제한 불가

---

## 🔒 Closed Poll 지원 (향후 개선)

### 개선 방향

#### 1. Merkle Tree 기반 화이트리스트

**구현 방법**:

- 투표 생성 시 유권자 목록(학번, 이메일 등) 입력
- Merkle Tree 구성 (`merkleRoot` 계산)
- 컨트랙트에 `merkleRoot` 저장
- ZKP 증명에서 Merkle Tree 검증 포함

**효과**:

- ✅ 화이트리스트에 등록된 유권자만 투표 가능
- ✅ 중복 투표 완전 차단 (같은 신원 = 같은 nullifierSecret)
- ✅ 실제 신원 검증 가능 (학번, 이메일 등)

#### 2. 신원 검증 연동

**구현 방법**:

- 학교 포털 API 연동
- 또는 이메일 인증
- 또는 학번 검증

**효과**:

- ✅ 실제 신원 검증
- ✅ 중복 투표 완전 차단

---

## 🐧 WSL 대체 이유

### 원래 계획: 라즈베리파이 2대

**Pi #1 (검증자 노드)**:

- ZKP 증명 생성 서버
- 느린 기기(노트북)를 위한 오프로딩
- HAProxy + Keepalived (장애 전환)

**Pi #2 (브로드캐스터)**:

- 트랜잭션 브로드캐스터
- RPC 백업

### 실제 구현: WSL + Vercel

**WSL (선택 사항)**:

- **역할**: ZKP 증명 생성 서버
- **기능**: Proof 생성 오프로딩
- **효과**: 증명 생성 속도 향상 (15초 → 3-6초)
- **필수 여부**: ❌ 선택 사항 (브라우저에서도 가능)

**Vercel (필수)**:

- **역할**: 프론트엔드 + API + Relayer
- **기능**:
  - 프론트엔드 (Next.js)
  - API Routes (투표 생성, 결과 조회 등)
  - Relayer (가스 대납)
- **필수 여부**: ✅ 필수

### WSL이 꼭 필요한가?

**답**: ❌ **필수 아님**

**이유**:

1. **브라우저에서도 증명 생성 가능**

   - Web Worker 사용
   - 단지 느림 (15초 vs 3-6초)

2. **Vercel만으로도 완전 작동**

   - 프론트엔드, API, Relayer 모두 Vercel에서 작동
   - WSL 없이도 모든 기능 사용 가능

3. **WSL은 속도 향상을 위한 선택**
   - 시연 시 속도가 중요할 때만 사용
   - 일반 사용자는 브라우저에서도 충분

---

## 📊 현재 vs 향후 비교

| 항목               | 현재 (Open Poll) | 향후 (Closed Poll)  |
| ------------------ | ---------------- | ------------------- |
| **화이트리스트**   | ❌ 없음          | ✅ Merkle Tree 기반 |
| **신원 검증**      | ❌ 없음          | ✅ 학번/이메일 검증 |
| **중복 투표 차단** | ⚠️ 같은 지갑만   | ✅ 완전 차단        |
| **익명성**         | ✅ 완전 보장     | ✅ 완전 보장        |
| **검증 가능성**    | ✅ Etherscan     | ✅ Etherscan        |
| **사용 편의성**    | ✅ 높음 (누구나) | ⚠️ 중간 (등록 필요) |

---

## 🎯 결론

### 현재 시스템의 한계

1. **Open Poll 방식**: 화이트리스트 없음
2. **중복 투표 가능**: 여러 지갑으로 여러 번 투표 가능
3. **신원 검증 없음**: MetaMask 지갑 주소만으로 투표

### 향후 개선 방향

1. **Closed Poll 지원**: Merkle Tree 기반 화이트리스트
2. **신원 검증 연동**: 학번, 이메일 등 실제 신원 검증
3. **완전한 중복 차단**: 같은 신원 = 같은 nullifierSecret

### WSL 대체

- **필수 여부**: ❌ 선택 사항
- **역할**: 증명 생성 속도 향상 (15초 → 3-6초)
- **대체 가능**: 브라우저에서도 가능 (느리지만)

---

**참고**: 현재 시스템은 "완전한 익명성"과 "검증 가능성"을 보장하지만, "신원 검증"과 "화이트리스트" 기능은 향후 개선 예정입니다.
